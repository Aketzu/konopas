<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8" />
  <title>Refactored program.js</title>

  <script src="raw/program.js"></script>
</head>

<body>

<div id="src">empty</div>

<script>
	var c = conferenceProgramme;
	var prog = [];
	for (var i = 0; i < c.length; ++i) {
		var o = {
			id: c[i].id,
			day: c[i].published_time_slot.start.substr(0,10),
			time: c[i].published_time_slot.start.substr(11,5),
			floor: "",
			room: c[i].published_room.name,
			title: c[i].title,
			precis: c[i].precis,
			people: []
		};

		switch(o.room) {
			case "Addams":
			case "Dusable":	
			case "Field":
			case "McCormick":
			case "Wright":				o.floor = "Silver West"; break;

			case "Plaza Ballroom":		o.floor = "Green East"; break;

			case "Crystal A":
			case "Crystal B":
			case "Crystal C":			o.floor = "Green West"; break;

			case "Buckingham":
			case "Columbian KK#3":
			case "Columbian KK#4":
			case "Columbian":
			case "Comiskey":
			case "Gold Coast":
			case "Haymarket":
			case "Picasso":	
			case "Stagg Field":	
			case "Wrigley":				o.floor = "Bronze West"; break;

			case "Columbus AB":
			case "Columbus CD":
			case "Columbus EF":
			case "Columbus G":
			case "Columbus H":
			case "Columbus IJ":
			case "Columbus IJ-KL":
			case "Columbus KL":
			case "Grand Ballroom":
			case "Grand Ballroom B":
			case "Grand Suite 2AB":
			case "Grand Suite 3":
			case "Grand Suite 5":		o.floor = "Gold East"; break;

			case "Regency Ballroom Foyer":
			case "San Francisco":
			case "Toronto LB#1":
			case "Toronto LB#2":		o.floor = "Gold West"; break;

			case "Fan Lounge KK#1":
			case "Fan Lounge KK#2":		o.floor = "Purple East"; break;

			case "Autograph Tables":
			case "Offsite":	
			case "Offsite 2":			o.floor = "?"; break;

			default: alert("Undefined floor for room '" + o.room + "'");
		}

		[ "title", "precis" ].map(function(el){
			o[el] = o[el].replace(/`/g, "'").replace(/\\(['"])/g, '$1');
		});

		for (var j = 0; j < c[i].people.length; ++j) {
			o.people[o.people.length] = { "id": c[i].people[j].id, "name": c[i].people[j].pubFirstName + " " + c[i].people[j].pubLastName };
		}
		prog[prog.length] = o;
	}
	prog.sort(function(a, b) {
		if (a.day < b.day) return -1;
		else if (a.day > b.day) return 1;
		else if (a.time < b.time) return -1;
		else if (a.time > b.time) return 1;
		else {
			var f = { "?": 0, "Purple East":1, "Gold East": 2,
				"Gold West": 3, "Bronze West": 4, "Green East": 5,
				"Green West": 6, "Silver West": 7 };
			if (f[a.floor] > f[b.floor]) return -1;
			else if (f[a.floor] < f[b.floor]) return 1;
			else if (a.room < b.room) return -1;
			else if (a.room > b.room) return 1;
			else return 0;
		}
	});
	document.getElementById("src").innerHTML = "<pre>prog = " + JSON.stringify(prog) + "</pre>";
</script>

</body>
</html>
