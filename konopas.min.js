"use strict";
function Server(e,t,n){this.id=e,this.stars=t,n=n||{},this.host=n.host||"https://konopas-server.appspot.com",this.el_id=n.el_id||"server_connect",this.err_el_id=n.err_el_id||"server_error",this.connected=!1,this.token=localStorage.getItem("konopas.token")||!1,this.ical=localStorage.getItem("konopas."+this.id+".ical_link")||!1,this.prog_data={},this.prog_server_mtime=0,this.my_votes_data={},this.my_votes_mtime=0,this.vote_timers={},this.pub_data=!1,this.pub_comments={},this.el=document.getElementById(this.el_id),this.err_el=!1,this.disconnect(),this.stars&&(this.stars.server=this),this.el&&this.id?this.exec("info"):_log("server init failed","warn");var r=/#server_error=(.+)/.exec(window.location.hash);r&&this.error(decodeURIComponent(r[1].replace(/\+/g," ")),window.location.href,this)}
function Stars(e,t){this.name="konopas."+e+".stars",t=t||{},this.store=t.store||localStorage,this.tag=t.tag||"has_star",this.server=!1,this.data=this.read()}
function link_to_short_url(e){return"http://is.gd/create.php?url="+encodeURIComponent(e.replace(/^http:\/\//,""))}
function link_to_qr_code(e){return"http://chart.apis.google.com/chart?cht=qr&chs=350x350&chl="+encodeURIComponent(e.replace(/^http:\/\//,""))}
function _log(e,t){if(ko.log_messages&&window.console)switch(t){case"error":console.error(e);break;case"warn":console.warn(e);break;default:console.log(e)}}
function EL(e){return e&&document.getElementById(e)}
function _new_elem(e,t,n,r){var i=document.createElement(e);return t&&(i.className=t),n&&(i.textContent=n),r&&(i.style.display="none"),i}
function _set_class(e,t,n){e.classList[n?"add":"remove"](t)}
function selected_id(e){var t=EL(e);if(!t)return"";var n=t.getElementsByClassName("selected");return n.length?n[0].id:""}
function hash_encode(e){return encodeURIComponent(e).replace(/%20/g,"+")}
function hash_decode(e){return decodeURIComponent(e.replace(/\+/g,"%20"))}
function i18n_translate_html(e,t){for(var n,r=document.querySelectorAll("["+t+"]"),i=0;n=r[i];++i){var a=n.getAttribute(t)||n.textContent.trim();if(a in e){var o=n.getAttribute(t+"-var"),s=n.getAttribute(t+"-attr"),l=e[a](o&&JSON.parse("{"+o.replace(/[^,:]+/g,'"$&"')+"}"));s?n.setAttribute(s,l):n.innerHTML=l}}}
function popup_open(e){if(e=e||window.event,1==e.which){var t=e.target,n=t.nextElementSibling;if(!n||!n.classList.contains("popup")){if(!t.href||!/\.(gif|jpe?g|png)$/i.test(t.href))return;n=_new_elem("img","popup"),n.src=t.href,t.parentNode.insertBefore(n,t.nextSibling)}var r=_new_elem("div","popup-wrap");r.onclick=
function(){n.parentNode.removeChild(n),r.parentNode.removeChild(r),t.parentNode.insertBefore(n,t.nextSibling)};var i=n.getAttribute("data-title")||"";i&&r.appendChild(_new_elem("div","popup-title",i)),n.parentNode.removeChild(n),r.appendChild(n),document.body.appendChild(r),t.href&&e.preventDefault()}}
function pre0(e){return(10>e?"0":"")+e}
function string_date(e){return e||(e=new Date),e.getFullYear()+"-"+pre0(e.getMonth()+1)+"-"+pre0(e.getDate())}
function string_time(e){return e||(e=new Date),pre0(e.getHours())+":"+pre0(e.getMinutes())}
function weekday(e){return i18n_txt("weekday_n",{N:e.getDay()})}
function _pretty_time(e,t){if(ko.time_show_am_pm){var n=e%12;0==n&&(n=12);var r=0==t&&ko.abbrev_00_minutes?"":":"+pre0(t);return n+r+(12>e?"am":"pm")}return pre0(e)+":"+pre0(t)}
function pretty_time(e){if(e instanceof Date)return _pretty_time(e.getHours(),e.getMinutes());if("string"==typeof e||e instanceof String){if(ko.time_show_am_pm){var t=e.split(":");return _pretty_time(parseInt(t[0],10),parseInt(t[1],10))}return e}return""}
function pretty_time_diff(e){var t=(Date.now()-e)/1e3,n=Math.abs(t),r=[1,60,60,24,7,4.333,12,1e9];if(20>n)return i18n_txt("just now");for(var i=0,a=r.length;a>i;++i)if((n/=r[i])<2)return i18n_txt("time_diff",{T:~~(n*=r[i]),T_UNIT:i-1,T_PAST:t>0})}
function parse_date(e){var t=e.match(/(\d+)/g);if(t.length<3)return!1;var n=parseInt(t[0],10),r=parseInt(t[1],10),i=parseInt(t[2],10);return n&&r&&i?new Date(n,r-1,i):!1}
function pretty_date(e){var t=e instanceof Date?e:parse_date(e);if(!t)return e;var n=weekday(t)+", "+t.getDate()+" "+i18n_txt("month_n",{N:t.getMonth()});return Math.abs(t-Date.now())>5184e6&&(n+=" "+t.getFullYear()),n}
function time_sum(e,t){var n=60*e.substr(0,2)+1*e.substr(3,2)+1*t,r=n/60>>0,i=n-60*r;return pre0(r%24)+":"+pre0(i)}
function storage_get(e){var t=sessionStorage.getItem("konopas."+ko.id+"."+e);return t?JSON.parse(t):t}
function storage_set(e,t){try{sessionStorage.setItem("konopas."+ko.id+"."+e,JSON.stringify(t))}catch(n){if(n.code!==DOMException.QUOTA_EXCEEDED_ERR||0!==sessionStorage.length)throw n;private_browsing_noted||(alert(i18n_txt("private_mode")),private_browsing_noted=!0)}}
function GlobToRE(e){var t=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\/-]","g");e=e.replace(t,"\\$&").replace(/\\\*/g,".*").replace(/\\\?/g,".");var n=e.match(/"[^"]*"|'[^']*'|\S+/g).map(
function(e){var t="\\b"+e.replace(/^(['"])(.*)\1$/,"$2")+"\\b";return t});return new RegExp(n.join("|"),"i")}
function set_view(e){for(var t=document.body.classList,n=0;n<views.length;++n)t[e==views[n]?"add":"remove"](views[n])}
function clean_name(e,t){var n="",r="";switch(e.name.length){case 1:r=e.name[0];break;case 2:e.name[1]?(n=e.name[0],r=e.name[1]):r=e.name[0];break;case 3:n=e.name[2]+" "+e.name[0],r=e.name[1];break;case 4:n=e.name[2]+" "+e.name[0],r=e.name[1]+", "+e.name[3]}return t?'<span class="fn">'+n.trim()+'</span> <span class="ln">'+r.trim()+"</span>":(n+" "+r).trim()}
function clean_links(e){var t=!1,n={};if("links"in e){if("img"in e.links&&e.links.img){var r=e.links.img.trim();/^www/.exec(r)&&(r="http://"+r),/:\/\//.exec(r)&&(n.img=r,t=!0)}if("url"in e.links&&e.links.url){var i=e.links.url.trim();/:\/\//.exec(i)||(i="http://"+i),n.url=i,t=!0}if("fb"in e.links&&e.links.fb){var a=e.links.fb.trim();a=a.replace(/^(https?:\/\/)?(www\.)?facebook.com(\/#!)?\//,""),/[^a-zA-Z0-9.]/.exec(a)&&!/^pages\//.exec(a)&&(a="search.php?q="+encodeURI(a).replace(/%20/g,"+")),n.fb=a,t=!0}if("twitter"in e.links&&e.links.twitter){var o=e.links.twitter.trim();o=o.replace(/[@＠﹫]/g,"").replace(/^(https?:\/\/)?(www\.)?twitter.com(\/#!)?\//,""),/[^a-zA-Z0-9_]/.exec(o)&&(o="search/users?q="+encodeURI(o).replace(/%20/g,"+")),n.twitter=o,t=!0}}return t?n:!1}
function arrays_equal(e,t){if(!e||!t)return!1;var n=e.length;if(n!=t.length)return!1;for(var r=0;n>r;++r)if(e[r]!=t[r])return!1;return!0}
function array_overlap(e,t){if(!e||!t)return 0;var n=e.length,r=t.length;if(n>r)return array_overlap(t,e);for(var i=0,a=0;n>a;++a)for(var o=0;r>o;++o)if(e[a]==t[o]){++i;break}return i}
function _item_people(e){if(!e.people||!e.people.length)return"";var t=e.people.map("undefined"!=typeof people&&people.length?
function(e){return'<a href="#part/'+hash_encode(e.id)+'">'+e.name+"</a>"}:
function(e){return e.name});return'<div class="item-people">'+t.join(", ")+"</div>\n"}
function _item_tags(e){if(!e.tags||!e.tags.length)return"";var t={};e.tags.forEach(
function(e){var n="tags",r=_prog_hash({tag:e}),i=e.split(":");i.length>1&&(n=i.shift(),e=i.join(":"));var a='<a href="'+r+'">'+e+"</a>";t[n]?t[n].push(a):t[n]=[a]});var n=[];for(var r in t)n.push(r.charAt(0).toUpperCase()+r.substr(1)+": "+t[r].join(", "));return'<div class="discreet">'+n.join("<br>")+"</div>\n"}
function _item_loc_str(e){var t="";return e.loc&&e.loc.length&&(t=e.loc[0],e.loc.length>1&&(t+=" ("+e.loc.slice(1).join(", ")+")")),e.mins&&e.mins!=ko.default_duration&&(t&&(t+=", "),t+=pretty_time(e.time)+" - "+pretty_time(time_sum(e.time,e.mins))),t}
function _item_sort(e,t){if(e.date<t.date)return-1;if(e.date>t.date)return 1;if(e.time<t.time)return-1;if(e.time>t.time)return 1;if(e.loc.length<t.loc.length)return-1;if(e.loc.length>t.loc.length)return 1;for(var n=e.loc.length-1;n>=0;--n){if(e.loc[n]<t.loc[n])return-1;if(e.loc[n]>t.loc[n])return 1}return 0}
function _item_show_extra(e,t){if(!EL("e"+t)){var n="",r=program.filter(
function(e){return e.id==t});r.length<1?n=i18n_txt("item_not_found",{ID:t}):(n=_item_tags(r[0])+_item_people(r[0]),r[0].desc&&(n+="<p>"+r[0].desc));var i=_new_elem("div","extra");i.id="e"+t,i.innerHTML=n,e.appendChild(i),server&&server.show_extras(t,e)}}
function item_show_list(e,t){var n=document.createDocumentFragment(),r="",i="",a="";e.length>(t?1:0)&&e.length<ko.expand_all_max_items&&(n.appendChild(_new_elem("div","item_expander","» ")).appendChild(_new_elem("a","js-link",i18n_txt("Expand all"))).id="item_expander_link");for(var o=0,s=e.length;s>o;++o){if(e[o].date!=r){if(e[o].date<r)return void item_show_list(e.sort(_item_sort),t);r=e[o].date,a="",i=pretty_date(e[o].date),n.appendChild(_new_elem("div","new_day",i))}if(e[o].time!=a){if(e[o].time<a)return void item_show_list(e.sort(_item_sort),t);a=e[o].time,n.appendChild(document.createElement("hr")),n.appendChild(_new_elem("div","new_time",pretty_time(e[o].time))).setAttribute("data-day",i.substr(0,3))}n.appendChild(_item_el(e[o]))}for(var l=EL("prog_ls");l.firstChild;)l.removeChild(l.firstChild);l.appendChild(n),server&&server.decorate_list(l);var c=EL("item_expander_link");c&&(c.onclick=
function(){var e=l.getElementsByClassName("item"),t=i18n_txt("Expand all");if(c.textContent==t){for(var n=0,r=e.length;r>n;++n)e[n].parentNode.classList.add("expanded"),_item_show_extra(e[n],e[n].id.substr(1));c.textContent=i18n_txt("Collapse all")}else{for(var n=0,r=e.length;r>n;++n)e[n].parentNode.classList.remove("expanded");c.textContent=t}});for(var d=l.getElementsByClassName("item_star"),o=0,s=d.length;s>o;++o)d[o].onclick=
function(){return stars.toggle(this,this.id.substr(1)),!1};for(var _=stars.list(),o=0,s=_.length;s>o;++o){var p=EL("s"+_[o]);p&&p.classList.add("has_star")}if(t){var u=document.getElementById("p"+t);u&&(u.parentNode.classList.add("expanded"),_item_show_extra(u,t),e.length>1&&u.scrollIntoView())}}
function item_list_click(e){for(var t=(e||window.event).target,n=!1;!/\bitem(_|$)/.test(t.className);){if("prog_ls"==t.id)return;"a"==t.tagName.toLowerCase()&&t.href&&(n=!0),t=t.parentNode}if(t.id&&"p"==t.id[0]){var r=t.id.substr(1),i=document.body.classList.contains("prog");if(n)i&&_prog_set_location_id(r);else{var a=t.parentNode.classList.toggle("expanded");a&&_item_show_extra(t,r),i&&_prog_set_location_id(a?r:"")}}}
function update_next_select(e){var t=EL("next_time_select");if(t){var n=30,r=[-12*n,12*n],i=new Date;i.setMinutes(15*Math.floor(i.getMinutes()/15)+r[0]),t.options.length=0;for(var a=r[0];a<=r[1];a+=n){var o=document.createElement("option");o.value=a,o.text=weekday(i)+", "+pretty_time(i),a==e&&(o.selected=!0),a||(o.id="next_time_select_now"),t.add(o),i.setMinutes(i.getMinutes()+n)}t.onchange=
function(){update_next_list(selected_id("next_type"))};var s=EL("next_earlier");s&&(s.onclick=
function(){t.selectedIndex=Math.max(t.selectedIndex-1,0),t.onchange()});var l=EL("next_later");l&&(l.onclick=
function(){t.selectedIndex=Math.min(t.selectedIndex+1,t.length-1),t.onchange()})}}
function update_next_list(e){var t=EL("next_time_select"),n=t.selectedIndex>=0?parseInt(t[t.selectedIndex].value):0;n||(n=0),update_next_select(n);var r=new Date;r.setMinutes(15*Math.floor(r.getMinutes()/15)+n);var i=string_date(r),a=string_time(r);r.setMinutes(r.getMinutes()-r.getTimezoneOffset());for(var o={},s=0,l=r.valueOf()+36e5,c=0,d=0,_=program.length;_>d;++d){var p=program[d];if(!(p.date<i||p.date==i&&p.time<a)){var u=Date.parse(p.date+"T"+p.time);if((!s||s>u)&&u>l&&(s=u),"next_by_room"==e){if(p.loc){if(o[p.loc[0]]){if(o[p.loc[0]].date<p.date)continue;if(o[p.loc[0]].date==p.date&&o[p.loc[0]].time<p.loc[0])continue}o[p.loc[0]]=p}}else l>=u&&(o["n"+ ++c]=p)}}var f=[];for(var m in o)f.push(o[m]);if(f.length>0)EL("next_start_note").textContent="";else if(s){var h=new Date;h.setMinutes(h.getMinutes()+n-h.getTimezoneOffset());var v=Math.floor((s-h)/6e4),g=Math.floor(v/60);g>=1&&(v-=60*g),EL("next_start_note").textContent=i18n_txt("next_start",{H:g,M:v})}else EL("next_start_note").textContent=i18n_txt("next_ended");item_show_list(f)}
function update_next_filters(e){"next_by_room"!=e&&(e="next_by_hour");for(var t=EL("next_type").getElementsByTagName("li"),n=0,r=t.length;r>n;++n)_set_class(t[n],"selected",t[n].id==e);storage_set("next",{next_type:e})}
function show_next_view(){set_view("next");var e="next_by_hour",t=storage_get("next")||{};"next_type"in t&&(e=t.next_type),update_next_list(e),update_next_filters(e)}
function next_filter_click(e){var t=(e||window.event).target;"next_type"==t.parentNode.id&&(update_next_list(t.id),update_next_filters(t.id))}
function show_star_view(e){set_view("star");var t=EL("star_data"),n=e&&"set:"==e.substr(1,4)?e.substr(5).split(","):[],r=program.filter(
function(e){return n.indexOf(e.id)>=0}).map(
function(e){return e.id});r.sort();var i=r.length,a=stars.list();a.sort();var o=a.length;if(o||i){var s="#star/set:"+a.join(",");if(i)if(arrays_equal(r,a))t.innerHTML="<p>"+i18n_txt("star_export_this",{THIS:s})+"<p>"+i18n_txt("star_export_share",{SHORT:link_to_short_url(location.href),QR:link_to_qr_code(location.href)}),server&&server.show_ical_link(t);else{var l=array_overlap(r,a),c=i-l,d=n.length-i,_="<p>"+i18n_txt("star_import_this",{THIS:location.href})+"<p>"+i18n_txt("star_import_diff",{PREV:o,NEW:c,SAME:l});if(d&&(_+=" "+i18n_txt("star_import_bad",{BAD:d})),o&&l==o||(_+='<p>&raquo; <a href="#star" id="star_set_set">'+i18n_txt("star_set")+"</a>"),o){if(l!=o){var p=[];c&&p.push(i18n_txt("add_n",{N:c})),p.push(i18n_txt("discard_n",{N:o-l})),_+=" ("+p.join(", ")+")"}c&&(_+='<p>&raquo; <a href="#star" id="star_set_add">'+i18n_txt("star_add",{N:c})+"</a>")}t.innerHTML=_;var u=EL("star_set_set");u&&(u.onclick=
function(){return stars.set(r),!0});var f=EL("star_set_add");f&&(f.onclick=
function(){return stars.add(r),!0})}else t.innerHTML='<p id="star_links">&raquo; '+i18n_txt("star_export_link",{URL:s,N:o});var m=program.filter(
function(e){return a.indexOf(e.id)>=0||r.indexOf(e.id)>=0});if(item_show_list(m),i){document.body.classList.add("show_set");for(var h=0;i>h;++h){var v=EL("s"+r[h]);v&&v.classList.add("in_set")}}}else t.innerHTML="<p>"+i18n_txt("star_hint"),EL("prog_ls").innerHTML=""}
function _prog_default_day(){var e="",t="",n=EL("day");if(!n)return"";var r=n.getElementsByTagName("li");if(!r||!r.length)return"";for(var i=0,a=r.length;a>i;++i){var o=r[i].id.substr(1);o&&"ll_days"!=o&&((!e||e>o)&&(e=o),(!t||o>t)&&(t=o))}var s=string_date(),l=s>e&&t>=s?s:e;return l}
function _prog_get_filters(e){var t={day:"",area:"",tag:"",query:"",id:""},n=window.location.toString().split("#")[1]||"",r=!1;if("prog"==n.substr(0,4))for(var i=n.substr(5).split("/"),a=0;a<i.length;++a){var o=i[a].split(":");if(2==o.length&&o[0]&&o[1]){if(ko.tag_categories)for(var s=0;s<ko.tag_categories.length;++s)if(o[0]==ko.tag_categories[s]){o[1]=o[0]+":"+o[1],o[0]="tag";break}t[o[0]]=hash_decode(o[1]),r=!0}}if(!e&&!r&&!document.body.classList.contains("prog")){var l=storage_get("prog");if(l)for(var c in l)t.hasOwnProperty(c)&&(t[c]=l[c])}return t}
function _prog_hash(e,t){var n={};for(var r in e)n[r]=e[r];if(t)for(var r in t)n[r]=t[r];var i=["#prog"];for(var r in n)if(r&&n[r]){if("area"==r&&"all_areas"==n[r])continue;if("tag"==r){if("all_tags"==n[r])continue;if(ko.tag_categories&&-1!==n[r].indexOf(":"))for(var a=n[r].split(":"),o=0;o<ko.tag_categories.length;++o)if(a[0]==ko.tag_categories[o]){r=a[0],n[r]=a[1];break}}i.push(r+":"+hash_encode(n[r]))}return i.length>1?i.join("/"):"#"}
function _prog_set_filters(e,t){if(t&&(!history||!history.replaceState))return!1;storage_set("prog",e);var n=_prog_hash(e),r=window.location.toString().split("#")[1]||"";if(r!=n.substr(1)){if(t){var i=window.location.toString().split("#")[0]+n;history.replaceState({},document.title,i)}else window.location.hash=n;return!0}return!1}
function _prog_set_location_id(e){var t=_prog_get_filters(!0);return e&&!t.day&&(t.day=_prog_default_day()),t.id=e,_prog_set_filters(t,!0)}
function _prog_filter(e){if(this.day&&e.date!=this.day)return!1;if(this.area)if(this.area instanceof RegExp){if(!this.area.test(e.loc.join(";")))return!1}else if(!e.loc||e.loc.indexOf(this.area)<0)return!1;if(this.tag)if(this.tag instanceof RegExp){if(!this.tag.test(e.title))return!1}else if(!e.tags||e.tags.indexOf(this.tag)<0)return!1;if(this.query){var t=this.query.test(e.title)||this.query.test(e.desc)||e.loc&&this.query.test(e.loc[0]);if(!t&&e.people)for(var n=0;n<e.people.length;++n)if(this.query.test(e.people[n].name)){t=!0;break}if(!t)return!1}return!0}
function _prog_show_list(e){var t=e.area||"";if(e.area&&EL(e.area)){var n=EL(e.area).getAttribute("data-regexp");n&&(e.area=new RegExp(n))}var r=e.tag||"";if(e.tag&&EL(e.tag)){var n=EL(e.tag).getAttribute("data-regexp");n&&(e.tag=new RegExp(n))}var i=e.query||"";e.query&&(e.query=GlobToRE(e.query));var a=!!e.id;if(a)for(var o in e)if("id"!=o&&e[o]){a=!1;break}var s=program.filter(a?
function(t){return t.id==e.id}:_prog_filter,e);if(e.id){for(var l=!1,o=0,c=s.length;c>o;++o)if(s[o].id==e.id){l=!0;break}if(!l&&(e.id="",_prog_set_filters(e)))return}e.area&&(e.area=t),e.tag&&(e.tag=r),e.query&&(e.query=i);var d=EL("filter_sum");if(d){var _={};for(var p in e)_[p]=e[p];_.id="",_.day||(_.day="all_days");var u=
function(e,t,n){return'<a href="'+_prog_hash(t,n)+'">'+e+"</a>"};if(a)d.innerHTML=i18n_txt("filter_sum_id",{N:s.length,TITLE:u(s[0].title,_,{}),ID:u(e.id,_,{})});else{var f={N:s.length,ALL:e.tag||e.day||e.area||e.query?"":u(i18n_txt("all"),{},0),TAG:e.tag?u(e.tag,_,{tag:""}):""};e.area&&(f.GOT_AREA=!0,f.AREA=u(e.area,_,{area:""})),e.query&&(f.GOT_Q=!0,f.Q=u(e.query,_,{query:""})),e.day&&(f.GOT_DAY=!0,f.DAY=u(i18n_txt("weekday_n",{N:parse_date(e.day).getDay()}),_,{day:"all_days"})),d.innerHTML=i18n_txt("filter_sum",f)}}item_show_list(s,e.id)}
function _prog_show_filters(e){var t=EL("prog_filters").getElementsByClassName("selected");if(t)for(var n=t.length-1;n>=0;--n){var r=t[n].classList;r.contains("popup-link")&&(t[n].textContent=t[n].getAttribute("data-title")||"More..."),r.remove("selected")}for(var i in e)if("query"==i){var a=EL("q");a&&(a.value=e.query,e.query&&a.classList.add("selected"))}else{var o=e[i];o?o.match(/^[^a-zA-Z]/)&&(o=i[0]+o):o="all_"+i+"s";var s=EL(o);if(s&&(s.classList.add("selected"),s.parentNode.id.match(/\d+$/))){var l=s.parentNode.parentNode.firstChild;l.classList.add("selected"),l.textContent=s.textContent}}var c=EL("q_hint");c&&(e.query?(/[?*"]/.test(e.query)?(c.innerHTML=i18n_txt("search_hint"),c.removeAttribute("onmouseup"),c.style.cursor="auto"):(c.innerHTML=i18n_txt("search_hint")+" "+i18n_txt("search_example",{X:e.query+"*"}),c.onmouseup=
function(){EL("q").value=e.query+"*",EL("q").focus(),EL("q").blur()},c.style.cursor="pointer"),c.style.display="block"):c.style.display="none")}
function show_prog_view(){var e=_prog_get_filters();if(set_view("prog"),!_prog_set_filters(e)){e.day||e.id||ko.show_all_days_by_default||(e.day=_prog_default_day()),_prog_show_filters(e);for(var t in e)t&&e[t]&&e[t]!="all_"+t+"s"||delete e[t];_prog_show_list(e)}}
function prog_filter_change(e){e=e||window.event;var t,n;switch(e.type){case"click":if("li"!=e.target.tagName.toLowerCase())return;var r=e.target.getElementsByClassName("popup");if(r&&r.length)return;switch(t=e.target.parentNode.id.replace(/\d+$/,""),n=e.target.id,t){case"day":n=n.replace(/^d/,"");break;case"area":n=n.replace(/^a([^a-zA-Z])/,"$1")}break;case"submit":e.preventDefault();case"blur":t="query",n=EL("q").value;break;default:return}var i=_prog_get_filters();i[t]=n,i.id&&"id"!=t&&(i.id=""),_prog_set_filters(i)}
function show_participant(e){var t=clean_name(e,!1),n="",r="",i=clean_links(e);if(i){n+='<dl class="linklist">';for(var a in i){var o=i[a];switch(a){case"url":n+='<dt>URL:<dd><a href="'+o+'">'+o+"</a>";break;case"twitter":n+='<dt>Twitter:<dd><a href="https://www.twitter.com/'+o+'">@'+o+"</a>";break;case"fb":n+='<dt>Facebook:<dd><a href="https://www.facebook.com/'+o+'">/'+o+"</a>";break;case"img":n+="<dt>"+i18n_txt("Photo")+':<dd><a href="'+o+'">'+o+"</a>";break;default:n+="<dt>"+a+":<dd>"+o}}n+="</dl>"}EL("part_names").innerHTML="",EL("part_info").innerHTML='<h2 id="part_title">'+t+"</h2>"+(e.bio||r?"<p>"+r+e.bio:"")+n,item_show_list(program.filter(
function(t){return e.prog.indexOf(t.id)>=0})),EL("top").scrollIntoView()}
function _name_in_range(e,t){switch(t.length){case 1:return e==t[0];case 2:return ko.non_ascii_people?e.localeCompare(t[0],ko.lc)>=0&&e.localeCompare(t[1],ko.lc)<=0:e>=t[0]&&e<=t[1];default:return t.indexOf(e)>=0}}
function show_participant_list(e){var t=e?people.filter(
function(t){var n=t.sortname[0].toUpperCase();return _name_in_range(n,e)}):people;EL("part_names").innerHTML=t.map(
function(e){return'<li><a href="#part/'+hash_encode(e.id)+'">'+clean_name(e,!0)+"</a></li>"}).join(""),EL("part_info").innerHTML="",EL("prog_ls").innerHTML=""}
function update_part_view(e,t){var n=EL("name_range");if(n)for(var r=n.getElementsByTagName("li"),i=0,a=r.length;a>i;++i)_set_class(r[i],"selected",r[i].getAttribute("data-range")==e);var i,o=t.substr(1);for(i=0,a=people.length;a>i;++i)if(people[i].id==o){show_participant(people[i]);break}i==people.length&&(t="",show_participant_list(e)),storage_set("part",{name_range:e,participant:t})}
function find_name_range(e){var t=e[0].toUpperCase();if(!t)return"";var n=EL("name_range");if(!n)return"";for(var r=n.getElementsByTagName("li"),i=0,a=r.length;a>i;++i){var o=r[i].getAttribute("data-range");if(o&&_name_in_range(t,o))return o}return""}
function show_part_view(e){"undefined"!=typeof people&&people.length||(window.location.hash="");var t=storage_get("part")||{},n=t.name_range||"",r=!document.body.classList.contains("part")&&t.participant||"";if(set_view("part"),e){var i=hash_decode(e.substr(1)),a=people.filter(
function(e){return e.id==i});if(!a.length)return void(window.location.hash="#part");r="p"+a[0].id,n=find_name_range(a[0].sortname)}else if(r)return void(window.location.hash="#part/"+r.substr(1));if(!n){var o=EL("name_range");o&&(n=o.getElementsByTagName("li")[0].getAttribute("data-range"))}update_part_view(n,r)}
function part_filter_click(e){var t=(e||window.event).target;if("name_range"==t.parentNode.id){var n=t.getAttribute("data-range")||"";storage_set("part",{name_range:n,participant:""}),window.location.hash="#part",update_part_view(n,"")}}
function part_init(){if("undefined"!=typeof people){for(var e,t=0;e=people[t];++t)e.sortname=((e.name[1]||"")+"  "+e.name[0]).toLowerCase().replace(/^ +/,"");people.sort(ko.non_ascii_people?
function(e,t){return e.sortname.localeCompare(t.sortname,ko.lc)}:
function(e,t){return e.sortname<t.sortname?-1:e.sortname>t.sortname}),EL("part_filters").onclick=part_filter_click}}
function init_last_updated(){var e=document.body.parentNode.getAttribute("manifest");if(lu&&e&&"http:"==location.protocol){var t=new XMLHttpRequest;t.onload=
function(){lu_time=new Date(this.getResponseHeader("Last-Modified")),show_last_updated()},t.open("GET",e,!0),t.send()}}
function show_last_updated(){if(lu&&lu_time){var e=lu.getElementsByTagName("span")[0];e.textContent=pretty_time_diff(lu_time),e.title=lu_time.toLocaleString(),e.onclick=
function(e){var t=(e||window.event).target,n=t.title;t.title=t.textContent,t.textContent=n},lu.style.display="inline"}}
function show_info_view(){set_view("info"),show_last_updated(),EL("prog_ls").innerHTML=""}
function init_view(){var e=window.location.hash.substr(1);switch(e.substr(0,4)){case"next":show_next_view();break;case"star":show_star_view(e.substr(4));break;case"part":show_part_view(e.substr(4));break;case"info":show_info_view();break;default:show_prog_view()}EL("load_disable")&&(EL("load_disable").style.display="none")}String.prototype.trim||(String.prototype.trim=
function(){return this.replace(/^\s+|\s+$/g,"")}),"undefined"==typeof document||"classList"in document.createElement("a")||!
function(e){var t="classList",n="prototype",r=(e.HTMLElement||e.Element)[n],i=Object,a=String[n].trim||
function(){return this.replace(/^\s+|\s+$/g,"")},o=Array[n].indexOf||
function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},s=
function(e,t){this.name=e,this.code=DOMException[e],this.message=t},l=
function(e,t){if(""===t)throw new s("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new s("INVALID_CHARACTER_ERR","String contains an invalid character");return o.call(e,t)},c=
function(e){for(var t=a.call(e.className),n=t?t.split(/\s+/):[],r=0,i=n.length;i>r;r++)this.push(n[r]);this._updateClassName=
function(){e.className=this.toString()}},d=c[n]=[],_=
function(){return new c(this)};if(s[n]=Error[n],d.item=
function(e){return this[e]||null},d.contains=
function(e){return e+="",-1!==l(this,e)},d.add=
function(e){e+="",-1===l(this,e)&&(this.push(e),this._updateClassName())},d.remove=
function(e){e+="";var t=l(this,e);-1!==t&&(this.splice(t,1),this._updateClassName())},d.toggle=
function(e){e+="",-1===l(this,e)?this.add(e):this.remove(e)},d.toString=
function(){return this.join(" ")},i.defineProperty){var p={get:_,enumerable:!0,configurable:!0};try{i.defineProperty(r,t,p)}catch(u){-2146823252===u.number&&(p.enumerable=!1,i.defineProperty(r,t,p))}}else i[n].__defineGetter__&&r.__defineGetter__(t,_)}(self),
function(e){e.i18n={lc:{en:
function(e){return 1===e?"one":"other"}},c:
function(e,t){if(!e)throw new Error("MessageFormat: Data required for '"+t+"'.")},n:
function(e,t,n){if(isNaN(e[t]))throw new Error("MessageFormat: '"+t+"' isn't a number.");return e[t]-(n||0)},v:
function(e,t){return i18n.c(e,t),e[t]},p:
function(e,t,n,r,i){return i18n.c(e,t),e[t]in i?i[e[t]]:(t=i18n.lc[r](e[t]-n),t in i?i[t]:i.other)},s:
function(e,t,n){return i18n.c(e,t),e[t]in n?n[e[t]]:n.other}},i18n.en={weekday_n:
function(e){return i18n.p(e,"N",0,"en",{0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday",other:"???"})},month_n:
function(e){return i18n.p(e,"N",0,"en",{0:"January",1:"February",2:"March",3:"April",4:"May",5:"June",6:"July",7:"August",8:"September",9:"October",10:"November",11:"December",other:"???"})},time_diff:
function(e){return i18n.v(e,"T")+" "+i18n.p(e,"T_UNIT",0,"en",{0:"seconds",1:"minutes",2:"hours",3:"days",4:"weeks",5:"months",6:"years",other:"???"})+" "+i18n.s(e,"T_PAST",{"true":"ago",other:"from now"})},search_hint:
function(){return'<b>Hint:</b> search is for full words in the item title, description, room, and participants. You may use * and ? as wildcards and "quoted words" for exact phrases.'},search_example:
function(e){return"For example, you could try <b>"+i18n.v(e,"X")+"</b>"},part_filter:
function(e){return i18n.s(e,"T",{first:"All participants by first name:",last:"All participants by last name:",other:"All programme participants"})},no_ko_id:
function(){return"No ID set! Please assign konopas_set.id a unique identifier."},old_browser:
function(){return"Unfortunately, your browser doesn't support some of the Javascript features required by KonOpas. To use, please try a different browser."},private_mode:
function(){return"It looks like you're using an iOS or Safari browser in private mode, which disables localStorage. This will result in a suboptimal KonOpas experience."},item_not_found:
function(e){return"Program id <b>"+i18n.v(e,"ID")+"</b> not found!"},next_ended:
function(){return"There are no more program items scheduled."},next_start:
function(e){return"The next program item starts in "+i18n.p(e,"H",0,"en",{0:"",one:"one hour and",other:i18n.n(e,"H")+" hours and"})+" "+i18n.p(e,"M",0,"en",{one:"one minute",other:i18n.n(e,"M")+" minutes"})+" after the set time."},star_export_this:
function(e){return'Your current selection is encoded in <a href="'+i18n.v(e,"THIS")+'" target="_blank">this page\'s URL</a>, which you may open elsewhere to share your selection.'},star_export_share:
function(e){return'For easier sharing, you can also generate a <a href="'+i18n.v(e,"SHORT")+'">shorter link</a> or a <a href="'+i18n.v(e,"QR")+'">QR code</a>.'},star_import_this:
function(e){return'Your previously selected items are shown with a highlighted interior, while those imported via <a href="'+i18n.v(e,"THIS")+'">this link</a> have a highlighted border.'},star_import_diff:
function(e){return"Your previous selection "+i18n.p(e,"PREV",0,"en",{0:"was empty",one:"had one item",other:"had "+i18n.n(e,"PREV")+" items"})+", and the imported selection has "+i18n.p(e,"NEW",0,"en",{0:"no new items",one:"one new item",other:i18n.n(e,"NEW")+" new items"})+i18n.p(e,"SAME",0,"en",{0:"",one:"and one which was already selected",other:"and "+i18n.n(e,"SAME")+" which were already selected"})+"."},star_import_bad:
function(e){return i18n.p(e,"BAD",0,"en",{0:"",one:"One of the imported items had an invalid ID.",other:i18n.n(e,"BAD")+" of the imported items had invalid IDs."})},star_set:
function(){return"Set my selection to the imported selection"},add_n:
function(e){return"add "+i18n.v(e,"N")},discard_n:
function(e){return"discard "+i18n.v(e,"N")},star_add:
function(e){return"Add the "+i18n.p(e,"N",0,"en",{one:"new item",other:i18n.n(e,"N")+" new items"})+" to my selection"},star_export_link:
function(e){return'<a href="'+i18n.v(e,"URL")+'">Export selection</a> ('+i18n.p(e,"N",0,"en",{one:"one item",other:i18n.n(e,"N")+" items"})+")"},star_hint:
function(){return'To "star" a program item, click on the square next to it. Your selections will be remembered, and shown in this view. You currently don\'t have any program items selected, so this list is empty.'},filter_sum_id:
function(e){return"Listing "+i18n.p(e,"N",0,"en",{one:"one item: "+i18n.v(e,"TITLE"),other:i18n.n(e,"N")+" items with id "+i18n.v(e,"ID")})},filter_sum:
function(e){return"Listing "+i18n.p(e,"N",0,"en",{one:"one "+i18n.v(e,"TAG")+" item",other:i18n.v(e,"ALL")+" "+i18n.n(e,"N")+" "+i18n.v(e,"TAG")+" items"})+" "+i18n.s(e,"GOT_DAY",{"true":"on "+i18n.v(e,"DAY"),other:""})+" "+i18n.s(e,"GOT_AREA",{"true":"in "+i18n.v(e,"AREA"),other:""})+" "+i18n.s(e,"GOT_Q",{"true":"matching the query "+i18n.v(e,"Q"),other:""})},server_cmd_fail:
function(e){return'The command "'+i18n.v(e,"CMD")+'" failed.'},show_comments:
function(e){return"Show "+i18n.p(e,"N",0,"en",{one:"one comment",other:i18n.n(e,"N")+" comments"})},post_author:
function(e){return i18n.v(e,"N")+" posted…"},ical_login:
function(){return"For other export options, please login."},ical_link:
function(){return"Your selection is available as an iCal (.ics) calendar at:"},ical_hint:
function(){return"Note that changes you make in this guide may take some time to show in your external calendar software."},ical_make:
function(e){return'To view your selection in your calendar app, you may also <br class="wide-only">'+i18n.v(e,"A_TAG")+"make it available</a> in iCal (.ics) calendar format"},login_why:
function(){return"Once you've verified your e-mail address, you'll be able to sync your data between different clients (including external calendars), as well as vote & comment on items. After signing in, no information will be transmitted to these external services."}}}(this),Server.prototype.disconnect=
function(){this.connected=!1,this.el&&(this.el.innerHTML='<div id="server_info">'+i18n_txt("Not connected")+"</div>"),document.body.classList.remove("logged-in")},Server.prototype.logout=
function(e){_log("server logout"),server.exec("/logout"),(e||window.event).preventDefault()},Server.prototype.error=
function(e,t,n){if(_log("server error "+e+", url: "+t,"error"),n=n||this,""==e){var r=t.replace(n.host,"").replace("/"+n.id+"/","");e=i18n_txt("server_cmd_fail",{CMD:"<code>"+r+"</code>"})}if(!n.err_el){var i=document.createElement("div");i.id=n.err_el_id,i.title=i18n_txt("Click to close"),i.onclick=
function(){n.err_el.style.display="none"},document.body.appendChild(i),n.err_el=i}return n.err_el.innerHTML="<div>"+i18n_txt("Server error")+": <b>"+e+"</b></div>",n.err_el.style.display="block",!0},Server.prototype.onmessage=
function(e,t){return e=e||window.event,e.origin!=t.host?(_log("Got an unexpected message from "+e.origin,"error"),void _log(e)):void JSON.parse(e.data,
function(e,n){switch(e){case"ok":t.cb_ok(n,t);break;case"fail":t.error("",n,t)}})},Server.prototype.prog_mtime=
function(){var e=this.prog_server_mtime;for(var t in this.prog_data)this.prog_data[t][1]>e&&(e=this.prog_data[t][1]);
return e},Server.prototype.add_prog=
function(e,t){e instanceof Array&&(e=e.join(",")),_log('server add_prog "'+e+'" '+(t?"1":"0"));var n=this.prog_mtime();this.exec("prog"+(t?"?add=":"?rm=")+e+(n?"&t="+n:""))},Server.prototype.set_prog=
function(e){_log('server set_prog "'+e);var t=this.prog_mtime();this.exec("prog?set="+e.join(",")+(t?"&t="+t:""))},Server.prototype.show_my_vote=
function(e,t,n){if(t=t||document.getElementById("v"+e)){"undefined"==typeof n&&(n=this.my_votes_data[e]);for(var r=t.firstElementChild;null!=r;r=r.nextElementSibling)if(r.classList.contains("v_pos"))switch(n){case 2:r.classList.add("voted"),r.classList.add("v2"),r.title="doubleplusgood";break;case 1:r.classList.add("voted"),r.classList.remove("v2"),r.title="good";break;default:r.classList.remove("voted"),r.classList.remove("v2"),r.title="good"}else _set_class(r,"voted",0>n)}},Server.prototype.vote=
function(e,t,n){if(n=n||this,!n.connected)return!1;if(n.pub_data){var r=n.my_votes_data[e];r&&--n.pub_data[e][0>r?0:r]}switch(n.my_votes_data[e]){case-1:0>t&&(t=0);break;case 1:t>0&&(t=2);break;case 2:t>0&&(t=0)}return _log("server vote "+e+" "+t),n.my_votes_data[e]=t,t&&n.pub_data&&(e in n.pub_data||(n.pub_data[e]=[0,0,0,0]),++n.pub_data[e][0>t?0:t]),n.show_pub_votes(e),n.show_my_vote(e,null,t),n.vote_timers[e]&&window.clearTimeout(n.vote_timers[e]),n.vote_timers[e]=window.setTimeout(
function(){n.exec("vote?v="+t+"&id="+e+"&t="+n.my_votes_mtime)},1e3),!0},Server.prototype.vote_click=
function(e,t){e=e||window.event;var n=!1,r=0;switch(e.target.classList[0]){case"v_pos":r=1;break;case"v_neg":r=-1}if(r){var i=e.target.parentNode;n=i.parentNode.parentNode.classList.contains("expanded")?!t.vote(i.id.substr(1),r,t):!0}n||(e.cancelBubble=!0,e.preventDefault(),e.stopPropagation())},Server.prototype.show_pub_votes=
function(e,t){if(t=t||document.getElementById("v"+e)){var n=this.pub_data&&this.pub_data[e];if(!n)return void t.classList.remove("has_votes");_set_class(t,"has_votes",n[0]||n[1]||n[2]);for(var r=t.firstElementChild;null!=r;r=r.nextElementSibling)r.textContent=r.classList.contains("v_pos")?"+"+(n[1]+2*n[2]):"-"+n[0];var i=t.nextSibling;if(i&&i.classList.contains("num-comments"))i.textContent=n[3]+(1==n[3]?" comment":" comments");else if(n[3]){var a=_new_elem("div","num-comments",n[3]+(1==n[3]?" comment":" comments"));t.parentNode.insertBefore(a,i)}}},Server.prototype.decorate_list=
function(e){for(var t=e.getElementsByClassName("votes"),n=0,r=t.length;r>n;++n){var i=t[n].id.substr(1);this.show_pub_votes(i,t[n]),i in this.my_votes_data&&this.show_my_vote(i,t[n])}},Server.prototype.onclick_show_comments=
function(e,t,n,r,i,a){e=e||window.event,e.cancelBubble=!0,e.preventDefault(),e.stopPropagation();var o=e.target;if(o.textContent.substr(0,4)==i18n_txt("Hide comments").substr(0,4)){var s=a.pub_data&&a.pub_data[t],l=s&&s[3]>0?s[3]:0;o.textContent=i18n_txt("show_comments",{N:l}),o.style.display=l?"block":"none",n.style.display="none",r.style.display=l?"none":"block",i.style.display="none"}else n.style.display="block","none"==i.style.display&&a.connected&&(r.style.display="block"),a.show_comments(t,a)},Server.prototype.onclick_show_comment_form=
function(e,t,n,r){e=e||window.event,e.cancelBubble=!0,e.preventDefault(),e.stopPropagation();var i=e.target;i.style.display="none",r.show_comment_form(t,i,n,r)},Server.prototype.make_comment_div=
function(e){var t=_new_elem("div","comment"),n=_new_elem("span","comment-author",e.name);t.appendChild(n);var r=new Date(1e3*e.ctime),i=_new_elem("span","comment-time",pretty_date(r)+" at "+pretty_time(r,!1));i.title=r.toString(),t.appendChild(i);var a=_new_elem("div","",e.text);return t.appendChild(a),t},Server.prototype.show_comments=
function(e,t){t=t||this;var n=document.getElementById("c"+e);if(n){var r=n.previousSibling;for(r&&"a"!=r.tagName.toLowerCase()&&(r=!1);n.firstChild;)n.removeChild(n.firstChild);var i=t.pub_comments[e];if("undefined"==typeof i)return r&&(r.classList.remove("js-link"),r.textContent=i18n_txt("Loading comments…")),void t.exec("comments?id="+e);var a=0;if(i)for(var o in i)++a,n.appendChild(t.make_comment_div(i[o]));if(t.pub_data&&(t.pub_data[e]?t.pub_data[e][3]=a:t.pub_data[e]=[0,0,0,a]),r&&(r.textContent=i18n_txt("Hide comments"),r.classList.add("js-link"),r.style.display=a?"block":"none"),!a){var s=document.getElementById("f"+e);if(s&&"none"==s.style.display){var l=s.previousSibling;l&&"a"==l.tagName.toLowerCase()&&(l.style.display="block")}}}},Server.prototype.show_comment_form=
function(e,t,n,r){if(r.connected){if(n.classList.contains("empty")){if(!document.getElementById("post_comment_iframe")){var i=document.createElement("iframe");i.id=i.name="post_comment_iframe",i.src="javascript:false",i.style.display="none",document.body.appendChild(i),window.onmessage=
function(e){r.onmessage(e,r)}}n.method="post",n.action=r.url("add_comment?id="+encodeURIComponent(e)),n.target="post_comment_iframe",n.innerHTML='<textarea name="text" rows="4" placeholder="'+i18n_txt("post_author",{N:r.connected[0]})+'"></textarea><input type="submit" name="submit"><input type="reset" value="'+i18n_txt("Cancel")+'"><label><input type="checkbox" name="anon"> '+i18n_txt("Post anonymously")+'</label><label><input type="checkbox" name="hide"> '+i18n_txt("Hide from public")+"</label>",n.onclick=
function(e){e=e||window.event,e.cancelBubble=!0,e.stopPropagation()},n.onsubmit=
function(){n.submit.value=i18n_txt("Posting…"),n.submit.disabled=!0,n.anon.checked&&(n.action+="&anon=1",n.anon.disabled=!0),n.hide.checked&&(n.action+="&hide=1",n.hide.disabled=!0)},n.onreset=
function(){t.style.display="block",n.style.display="none"},n.classList.remove("empty")}else n.submit.disabled=!1,n.anon.disabled=!1,n.hide.disabled=!1;n.submit.value=i18n_txt("Post comment"),n.style.display="block"}},Server.prototype.make_comments_wrap=
function(e){var t=this.pub_data&&this.pub_data[e],n=t&&t[3]>0?t[3]:0,r=_new_elem("div","comments-wrap"),i=_new_elem("a","js-link discreet");i.textContent=i18n_txt("show_comments",{N:n}),i.style.display=n?"block":"none",r.appendChild(i);var a=_new_elem("div","comments");a.id="c"+e,a.style.display="none",r.appendChild(a);var o=_new_elem("a","js-link discreet",i18n_txt("Add a comment"));o.style.display=n||!this.connected?"none":"block",r.appendChild(o);var s=_new_elem("form","empty");s.id="f"+e,s.style.display="none",r.appendChild(s);var l=this;return i.onclick=
function(t){l.onclick_show_comments(t,e,a,o,s,l)},o.onclick=
function(t){l.onclick_show_comment_form(t,e,s,l)},r},Server.prototype.show_extras=
function(e,t){if(this.pub_data){var n=this;document.getElementById("c"+e)||t.appendChild(n.make_comments_wrap(e));var r="v"+e,i=document.getElementById(r);i&&(i.onclick=
function(e){n.vote_click(e,n)}),this.show_my_vote(e,i)}},Server.prototype.show_ical_link=
function(e){var t="";if(this.connected?this.ical&&(t="string"==typeof this.ical?i18n_txt("ical_link")+'<br><a href="'+this.ical+'">'+this.ical+'</a><br><span class="hint">'+i18n_txt("ical_hint")+"</span>":i18n_txt("ical_make",{A_TAG:'<a id="ical_link" class="js-link">'})):t=i18n_txt("ical_login"),e)e.innerHTML+='<p id="ical_text">'+t;else{var n=document.getElementById("ical_text");n&&(n.innerHTML=t)}var r=document.getElementById("ical_link");if(r){var i=this;r.onclick=
function(){i.exec("ical_link")}}},Server.prototype.url=
function(e){return this.token&&(e+=(-1!=e.indexOf("?")?"&":"?")+"k="+encodeURIComponent(this.token)),this.host+("/"==e[0]?"":"/"+this.id+"/")+e},Server.prototype.exec=
function(e){if(/^vote/.test(e)&&!this.connected)return void _log("server not connected: "+e,"warn");var t=document.createElement("script"),n=!1,r=this.url(e),i=this;t.src=r,t.async=!0,t.onerror=
function(e){i.error("",(e||window.event).target.src,i)},t.onload=t.onreadystatechange=
function(){n||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(n=!0,t.onload=t.onreadystatechange=null,t&&t.parentNode&&t.parentNode.removeChild(t))},document.getElementsByTagName("head")[0].appendChild(t)},Server.prototype.cb_ok=
function(e,t){t=t||this;var n=/^(?:https?:\/\/[^\/]+)?\/?([^?\/]*)(?:\/([^?]*))(?:\?(.*))?/.exec(e),r=n[2]||"",i=n[3]||"";switch(r){case"logout":t.disconnect(),t.token=!1,localStorage.removeItem("konopas.token"),t.prog_data={},t.prog_server_mtime=0,t.my_votes_data={},t.my_votes_mtime=0,t.stars&&(t.stars.data={},t.stars.write(),init_view()),t.exec("info"),_log("server ok (logout): "+JSON.stringify(e));break;case"prog":var a=/&server_mtime=(\d+)/.exec(i);a&&(t.prog_server_mtime=parseInt(a[1],10)),_log("server ok (prog): "+JSON.stringify(e));break;case"vote":var a=/&server_mtime=(\d+)/.exec(i);a&&(t.my_votes_mtime=parseInt(a[1],10)),_log("server ok (vote): "+JSON.stringify(e));break;case"add_comment":var o=/\bid=([^&]+)/.exec(i);if(o){t.exec("comments?id="+o[1]);var s=document.getElementById("f"+o[1]);s&&s.reset()}_log("server ok (add_comment): "+JSON.stringify(e));break;default:_log("server ok (???): "+JSON.stringify(e),"warn")}},Server.prototype.cb_fail=
function(e){this.error(e.msg,e.url,this)},Server.prototype.cb_info=
function(e){_log("server info: "+JSON.stringify(e)),this.connected=[e.name,e.email],this.el.innerHTML='<div id="server_info"><a id="server_logout" href="'+this.url(e.logout)+'">'+i18n_txt("Logout")+'</a> <span id="server_user" title="'+(e.name!=e.email?e.email:"")+'">'+e.name.replace(/@.*/,"")+"</span></div>",e.ical&&(this.ical=this.ical||!0,this.show_ical_link(!1)),document.getElementById("server_logout").onclick=this.logout,document.body.classList.add("logged-in"),jsErrLog&&(jsErrLog.info=e.name.replace(/[ @].*/,""))},Server.prototype.cb_token=
function(e){_log("server token: "+e),this.token=e,localStorage.setItem("konopas.token",e)},Server.prototype.cb_login=
function(e){_log("server login: "+JSON.stringify(e));var t=[];for(var n in e)t.push('<a href="'+this.url(n)+'">'+e[n]+"</a>");this.el.innerHTML='<div id="login-links">\n&raquo; <span class="popup-link" id="login-popup-link">'+i18n_txt("Login to sync your data")+'</span>\n<div class="popup" id="login-popup">'+i18n_txt("login_why")+"\n<ul>\n<li>"+t.join("\n<li>")+"\n</ul></div></div>",EL("login-popup-link").onclick=popup_open},Server.prototype.cb_my_prog=
function(e){if(_log("server my_prog: "+JSON.stringify(e)),this.prog_data=e.prog,e.t0)for(var t in this.prog_data)this.prog_data[t][1]+=e.t0;this.stars?this.stars.sync(this.prog_data):_log("Server.stars required for prog sync","warn")},Server.prototype.cb_my_votes=
function(e){_log("server my_votes: "+JSON.stringify(e)),this.my_votes_data=e.votes,this.my_votes_mtime=e.mtime;for(var t in e.votes)this.show_my_vote(t)},Server.prototype.cb_pub_data=
function(e){_log("server pub_data: "+JSON.stringify(e)),this.pub_data=e;for(var t in e)this.show_pub_votes(t);for(var n=document.getElementsByClassName("expanded"),r=0;r<n.length;++r){var i=n[r].getElementsByClassName("item");i&&this.show_extras(i[0].id.substr(1),i[0])}},Server.prototype.cb_show_comments=
function(e,t){_log("server show_comments ("+e+"): "+JSON.stringify(t)),t.sort(
function(e,t){return e.ctime-t.ctime}),this.pub_comments[e]=t,this.show_comments(e,this)},Server.prototype.cb_ical_link=
function(e){this.ical=e,localStorage.setItem("konopas."+this.id+".ical_link",e),this.show_ical_link(!1)},Stars.prototype.read=
function(){return JSON.parse(this.store.getItem(this.name)||"{}")},Stars.prototype.write=
function(){try{this.store.setItem(this.name,JSON.stringify(this.data))}catch(e){if(e.code!=DOMException.QUOTA_EXCEEDED_ERR||0!=this.store.length)throw e}},Stars.prototype.list=
function(){var e=[];if(this.data)for(var t in this.data)2==this.data[t].length&&this.data[t][0]&&e.push(t);return e},Stars.prototype.add=
function(e,t){t=t||Math.floor(Date.now()/1e3),e.forEach(
function(e){this.data[e]=[1,t]},this),this.write(),this.server&&this.server.set_prog(this.list())},Stars.prototype.set=
function(e){var t=Math.floor(Date.now()/1e3);if(this.data)for(var n in this.data)this.data[n]=[0,t];this.add(e,t)},Stars.prototype.toggle=
function(e,t){var n=!e.classList.contains(this.tag),r=Math.floor(Date.now()/1e3);this.data[t]=[n?1:0,r],this.write(),this.server&&this.server.add_prog(t,n),n?e.classList.add(this.tag):e.classList.remove(this.tag)},Stars.prototype.sync=
function(e){var t=[],n=!1;for(var r in e)2==e[r].length?(!(r in this.data)||e[r][1]>this.data[r][1])&&(t.push(r),r in this.data&&e[r][0]==this.data[r][0]||(n=!0),this.data[r]=e[r]):_log("Stars.sync: invalid input "+r+": "+JSON.stringify(e[r]),"warn");if(t.length&&(_log("Stars.sync: local changes: "+t+(n?" -> redraw":"")),this.write(),n&&init_view()),this.server){var i=[],a=[];for(var r in this.data)(!(r in e)||e[r][1]<this.data[r][1])&&(this.data[r][0]?i.push(r):a.push(r));i.length&&(_log("Stars.sync: server add: "+i),this.server.add_prog(i,!0)),a.length&&(_log("Stars.sync: server rm: "+a),this.server.add_prog(a,!1)),t.length||i.length||a.length||_log("Stars.sync: no changes")}};var ko={id:"",lc:"en",full_version:!navigator.userAgent.match(/Android [12]/),tag_categories:!1,default_duration:60,time_show_am_pm:!1,abbrev_00_minutes:!0,always_show_participants:!1,expand_all_max_items:100,show_all_days_by_default:!1,non_ascii_people:!1,use_server:!1,log_messages:!0};if("object"==typeof konopas_set)for(var i in konopas_set)ko[i]=konopas_set[i];var i18n_txt=
function(e){return e};"undefined"!=typeof i18n&&i18n[ko.lc]&&(i18n_txt=
function(e,t){return e in i18n[ko.lc]?i18n[ko.lc][e](t):e},i18n_translate_html(i18n[ko.lc],"data-txt")),ko.id||alert(i18n_txt("no_ko_id")),Array.prototype.indexOf&&Array.prototype.filter&&Array.prototype.map&&Date.now&&"localStorage"in window||alert(i18n_txt("old_browser"));var stars=new Stars(ko.id),server=ko.use_server&&window.Server&&new Server(ko.id,stars),private_browsing_noted=!1,views=["next","star","prog","part","info"],_item_el=
function(){var e=_new_elem("div","item_frame"),t=e.appendChild(_new_elem("div","item_star")),n=e.appendChild(_new_elem("div","item")),r=n.appendChild(_new_elem("div","title")),i=n.appendChild(_new_elem("div","loc")),a=ko.use_server?n.appendChild(_new_elem("div","votes")):{id:""};return ko.use_server&&(a.textContent=i18n_txt("Votes")+": ",a.appendChild(_new_elem("a","v_pos","+0")).title="good",a.appendChild(document.createTextNode(" / ")),a.appendChild(_new_elem("a","v_neg","-0")).title="not so good"),
function(o){return t.id="s"+o.id,n.id="p"+o.id,r.textContent=o.title,i.textContent=_item_loc_str(o),a.id="v"+o.id,e.cloneNode(!0)}}(),lu=EL("last-updated"),lu_time=0;EL("prog_ls").onclick=item_list_click,EL("next_filters").onclick=next_filter_click;var pf=EL("prog_filters");pf.onclick=prog_filter_change;for(var pl=pf.getElementsByClassName("popup-link"),i=0;i<pl.length;++i)pl[i].setAttribute("data-title",pl[i].textContent),pl[i].nextElementSibling.onclick=prog_filter_change;var sf=EL("search");if(sf&&(sf.onsubmit=EL("q").onblur=prog_filter_change,sf.onreset=
function(){_prog_set_filters({})}),part_init(),EL("scroll_link")){EL("scroll_link").onclick=
function(){return EL("top").scrollIntoView(),!1};var prev_scroll={i:0,top:0},n=0;ko.full_version?window.onscroll=
function(){var e=window.pageYOffset;EL("scroll").style.display=e>0?"block":"none",e+=20;var t=EL("time");if(t){var n=document.getElementsByClassName("new_time");if(n.length)if(e<n[0].offsetTop)prev_scroll.i=0,prev_scroll.top=n[0].offsetTop,t.style.display="none";else{var r=prev_scroll.top?prev_scroll.i:1;if(r>=n.length&&(r=n.length-1),e>n[r].offsetTop){for(;r<n.length&&e>n[r].offsetTop;)++r;--r}else for(;r>=0&&e<n[r].offsetTop;)--r;0>r&&(r=0),prev_scroll.i=r,prev_scroll.top=n[r].offsetTop,t.textContent=n[r].getAttribute("data-day")+"\n"+n[r].textContent,t.style.display="block"}}}:(EL("time").style.display="none",EL("scroll").style.display="none")}init_last_updated();for(var pl=document.getElementsByClassName("popup-link"),i=0;i<pl.length;++i)pl[i].addEventListener("click",popup_open);init_view(),window.onhashchange=init_view,EL("refresh")&&window.addEventListener("load",
function(){var e=window.applicationCache;e.addEventListener("updateready",
function(){e.status==e.UPDATEREADY&&(EL("refresh").classList.add("enabled"),EL("refresh").onclick=
function(){window.location.reload()})},!1),e.status!=e.UNCACHED&&window.setInterval(
function(){e.update()},36e5)},!1);